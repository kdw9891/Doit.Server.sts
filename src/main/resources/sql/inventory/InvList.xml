<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="InvList">

	<!-- 아이템 카테고리 List -->
  <select id="SelectCategory" resultType="HashMap" parameterType="HashMap">
	SELECT 
	    category_id
	,   category_name
	FROM 
	    tb_item_categories
  </select>
  
  <!-- 인벤토리 리스트 불러오기 -->
  <select id="SelectInv" resultType="HashMap" parameterType="HashMap">
	 SELECT 
        inv.`inventory_id`,
        inv.`user_id`,
        inv.`item_id`,
        itm.`item_name`,
        itm.`item_description`,
        itm.`item_price`,
        cat.`category_name` AS item_category,
        itm.`item_rarity`,
        img.`image_id`,
        inv.`quantity`,
        inv.`is_equipped`,
        inv.`is_used`,
        inv.`purchase_date`,
        inv.`used_date`
    FROM 
        `tb_user_inventory` inv
    LEFT JOIN 
        `tb_items` itm
        ON inv.`item_id` = itm.`item_id`
    LEFT JOIN 
        `tb_item_images` img 
        ON inv.`item_id` = img.`item_id`
    LEFT JOIN 
        `tb_item_categories` cat
        ON itm.`category_id` = cat.`category_id`
    WHERE 
        inv.user_id = #{user_id};
  </select>
  
  <!-- 사용자 인벤토리 추가 및 업데이트 -->
  <insert id="InsertUserInventory" parameterType="HashMap">
        INSERT INTO tb_user_inventory (
        	user_id
        ,	item_id
        ,	quantity
        ,	is_equipped
        ,	is_used
        ,	purchase_date
        ) VALUES (
        	#{user_id}
        ,	#{item_id}
        ,	#{quantity}
        ,	0
        ,	0
        ,	CURRENT_TIMESTAMP()
        )
        ON DUPLICATE KEY UPDATE
            quantity = quantity + #{quantity};
  </insert>
  

</mapper>